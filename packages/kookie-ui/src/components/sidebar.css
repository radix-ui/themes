@import './_internal/base-menu.css';
@import './_internal/base-sidebar.css';
@import './_internal/base-sidebar-menu.css';

/*
  Compact rail presentation
  - Pattern B (split): scope to .rt-ShellSidebarRail
  - Pattern A (single): scope to Shell region in rail state
*/
.rt-ShellSidebarRail :where(.rt-SidebarContent),
:where(.rt-ShellSidebar[data-state='rail'] .rt-SidebarContent) {
  padding: var(--space-2);
}

.rt-ShellSidebarRail :where(.rt-SidebarMenuButton),
:where(.rt-ShellSidebar[data-state='rail'] .rt-SidebarMenuButton) {
  justify-content: center;
  align-items: center;
  flex-direction: column;
  gap: var(--space-1);
  padding: var(--space-2) var(--space-1);
}

.rt-ShellSidebarRail :where(.rt-SidebarMenuBadge),
.rt-ShellSidebarRail :where(.rt-SidebarMenuShortcut),
:where(.rt-ShellSidebar[data-state='rail'] .rt-SidebarMenuBadge),
:where(.rt-ShellSidebar[data-state='rail'] .rt-SidebarMenuShortcut) {
  display: none;
}

.rt-ShellSidebarRail :where(.rt-SidebarGroupLabel),
:where(.rt-ShellSidebar[data-state='rail'] .rt-SidebarGroupLabel) {
  display: block;
  text-align: center;
  font-size: var(--font-size-0);
  line-height: var(--line-height-0);
  color: var(--gray-a9);
  font-weight: var(--font-weight-medium);
}

/* Hide submenu chevrons and flatten sublists in rail */
.rt-ShellSidebarRail :where(.rt-SidebarMenuSubTriggerIcon),
:where(.rt-ShellSidebar[data-state='rail'] .rt-SidebarMenuSubTriggerIcon) {
  display: none;
}

.rt-ShellSidebarRail :where(.rt-SidebarMenuSubList),
:where(.rt-ShellSidebar[data-state='rail'] .rt-SidebarMenuSubList) {
  padding-left: 0;
  border-left: none;
  margin-left: 0;
}

/* Note: label styling omitted to avoid type-selector-specificity; use Text component for fine control */

/* Container Variants */
.rt-SidebarContainer:where(.rt-variant-outline) {
  background-color: var(--color-panel);
  backdrop-filter: var(--backdrop-filter-panel);
  
  /* Component-level overrides (higher specificity) - remap --color-panel */
  &:where([data-panel-background='solid']) {
    --color-panel: var(--color-panel-solid);
    backdrop-filter: none;
    --backdrop-filter-panel: none;
    --backdrop-filter-components: none;
  }

  &:where([data-panel-background='translucent']) {
    --color-panel: var(--color-panel-translucent);
    backdrop-filter: var(--backdrop-filter-panel);
    --backdrop-filter-panel: blur(var(--backdrop-blur-panel));
    --backdrop-filter-components: blur(var(--backdrop-blur-components));
  }
  
  /* Floating sidebars get full inset border */
  :where(.rt-SidebarRoot[data-type="floating"]) & {
    box-shadow: inset 0 0 0 1px var(--gray-a6);
  }
  
  /* Non-floating sidebars get border only on the content-facing side */
  :where(.rt-SidebarRoot[data-type="sidebar"][data-side="left"]) & {
    box-shadow: inset -1px 0 0 0 var(--gray-a6);
  }
  
  :where(.rt-SidebarRoot[data-type="sidebar"][data-side="right"]) & {
    box-shadow: inset 1px 0 0 0 var(--gray-a6);
  }
}

.rt-SidebarContainer:where(.rt-variant-ghost) {
  background-color: transparent;
  backdrop-filter: none;
  border: none;
}

.rt-SidebarContainer:where(.rt-variant-soft) {
  /* Base state: solid colors for solid panels */
  background-color: var(--gray-2);

  /* Theme-level translucent override */
  :where([data-panel-background='translucent']) & {
    background-color: color-mix(in srgb, var(--gray-a2), var(--gray-2) 60%);
    backdrop-filter: var(--backdrop-filter-panel);
  }

  /* Component-level overrides (higher specificity) */
  &:where([data-panel-background='solid']) {
    background-color: var(--gray-2);
    backdrop-filter: none;
    --backdrop-filter-components: none;
  }

  &:where([data-panel-background='translucent']) {
    background-color: color-mix(in srgb, var(--gray-a2), var(--gray-2) 60%);
    backdrop-filter: var(--backdrop-filter-panel);
    --backdrop-filter-panel: blur(var(--backdrop-blur-panel));
    --backdrop-filter-components: blur(var(--backdrop-blur-components));
  }
}

.rt-SidebarContainer:where(.rt-variant-surface) {
  /* Base state: neutral gray background (maintains sidebar neutrality) */
  background-color: var(--gray-1);
  
  /* Theme-level translucent override */
  :where([data-panel-background='translucent']) & {
    background-color: color-mix(in srgb, var(--gray-a1), var(--gray-1) 60%);
    backdrop-filter: var(--backdrop-filter-panel);
  }

  /* Component-level overrides (higher specificity) */
  &:where([data-panel-background='solid']) {
    background-color: var(--gray-1);
    backdrop-filter: none;
    --backdrop-filter-panel: none;
    --backdrop-filter-components: none;
  }

  &:where([data-panel-background='translucent']) {
    background-color: color-mix(in srgb, var(--gray-a1), var(--gray-1) 60%);
    backdrop-filter: var(--backdrop-filter-panel);
    --backdrop-filter-panel: blur(var(--backdrop-blur-panel));
    --backdrop-filter-components: blur(var(--backdrop-blur-components));
  }
  
  /* Inset border like Card surface variant */
  /* Floating sidebars get full inset border */
  :where(.rt-SidebarRoot[data-type="floating"]) & {
    box-shadow: inset 0 0 0 1px var(--gray-6);
    
    /* Theme-level translucent override */
    :where([data-panel-background='translucent']) & {
      box-shadow: inset 0 0 0 1px var(--gray-a6);
    }
  }
  
  /* Non-floating sidebars get border only on the content-facing side */
  :where(.rt-SidebarRoot[data-type="sidebar"][data-side="left"]) & {
    box-shadow: inset -1px 0 0 0 var(--gray-6);
    
    /* Theme-level translucent override */
    :where([data-panel-background='translucent']) & {
      box-shadow: inset -1px 0 0 0 var(--gray-a6);
    }
  }
  
  :where(.rt-SidebarRoot[data-type="sidebar"][data-side="right"]) & {
    box-shadow: inset 1px 0 0 0 var(--gray-6);
    
    /* Theme-level translucent override */
    :where([data-panel-background='translucent']) & {
      box-shadow: inset 1px 0 0 0 var(--gray-a6);
    }
  }
}

/* Header/Footer Layout Utilities */
.rt-SidebarHeader:where(.rt-SidebarHeader--container) {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: var(--space-2);
  padding: var(--base-menu-content-padding);
  min-height: var(--base-menu-item-height);
  
  /* Make MenuButtons expand to full width */
  & :where(.rt-SidebarMenuButton) {
    flex: 1;
  }
}

.rt-SidebarFooter:where(.rt-SidebarFooter--container) {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: var(--space-2);
  padding: var(--base-menu-content-padding);
  min-height: var(--base-menu-item-height);
  
  /* Make MenuButtons expand to full width */
  & :where(.rt-SidebarMenuButton) {
    flex: 1;
  }
}

/* Flex utilities for header/footer layouts */
.rt-SidebarHeader:where(.rt-flex-row) { flex-direction: row; }
.rt-SidebarHeader:where(.rt-flex-col) { flex-direction: column; }
.rt-SidebarHeader:where(.rt-items-center) { align-items: center; }
.rt-SidebarHeader:where(.rt-items-start) { align-items: flex-start; }
.rt-SidebarHeader:where(.rt-items-end) { align-items: flex-end; }
.rt-SidebarHeader:where(.rt-justify-between) { justify-content: space-between; }
.rt-SidebarHeader:where(.rt-justify-center) { justify-content: center; }
.rt-SidebarHeader:where(.rt-justify-start) { justify-content: flex-start; }
.rt-SidebarHeader:where(.rt-justify-end) { justify-content: flex-end; }
.rt-SidebarHeader:where(.rt-gap-1) { gap: var(--space-1); }
.rt-SidebarHeader:where(.rt-gap-2) { gap: var(--space-2); }
.rt-SidebarHeader:where(.rt-gap-3) { gap: var(--space-3); }
.rt-SidebarHeader:where(.rt-gap-4) { gap: var(--space-4); }

.rt-SidebarFooter:where(.rt-flex-row) { flex-direction: row; }
.rt-SidebarFooter:where(.rt-flex-col) { flex-direction: column; }
.rt-SidebarFooter:where(.rt-items-center) { align-items: center; }
.rt-SidebarFooter:where(.rt-items-start) { align-items: flex-start; }
.rt-SidebarFooter:where(.rt-items-end) { align-items: flex-end; }
.rt-SidebarFooter:where(.rt-justify-between) { justify-content: space-between; }
.rt-SidebarFooter:where(.rt-justify-center) { justify-content: center; }
.rt-SidebarFooter:where(.rt-justify-start) { justify-content: flex-start; }
.rt-SidebarFooter:where(.rt-justify-end) { justify-content: flex-end; }
.rt-SidebarFooter:where(.rt-gap-1) { gap: var(--space-1); }
.rt-SidebarFooter:where(.rt-gap-2) { gap: var(--space-2); }
.rt-SidebarFooter:where(.rt-gap-3) { gap: var(--space-3); }
.rt-SidebarFooter:where(.rt-gap-4) { gap: var(--space-4); }

/* Header/Footer Menu Button Support */
.rt-SidebarHeader :where(.rt-SidebarMenuButton),
.rt-SidebarFooter :where(.rt-SidebarMenuButton) {
  /* Inherit all base MenuButton styles */
  display: flex;
  align-items: center;
  gap: var(--space-2);
  min-height: var(--base-menu-item-height);
  padding-top: var(--base-menu-item-padding-y);
  padding-bottom: var(--base-menu-item-padding-y);
  padding-left: var(--base-menu-item-padding-left);
  padding-right: var(--base-menu-item-padding-right);
  box-sizing: border-box;
  position: relative;
  outline: none;
  background: none;
  border: none;
  width: 100%;
  text-align: left;
  cursor: var(--cursor-menu-item);
  user-select: none;
  
  /* Header/Footer-specific styling */
  justify-content: flex-start;
  
  /* Transitions */
  transition: background var(--motion-duration-small) var(--motion-ease-standard), 
              box-shadow var(--motion-duration-small) var(--motion-ease-standard),
              filter var(--motion-duration-small) var(--motion-ease-standard);
  
  /* Focus state */
  &:where(:focus-visible) {
    outline: 2px solid var(--focus-8);
    outline-offset: 2px;
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    transition: none;
  }
}

.rt-SidebarHeader :where(.rt-SidebarMenuButton) {
  border-radius: var(--sidebar-base-border-radius) var(--sidebar-base-border-radius) 0 0;
}

.rt-SidebarFooter :where(.rt-SidebarMenuButton) {
  border-radius: 0 0 var(--sidebar-base-border-radius) var(--sidebar-base-border-radius);
}

/***************************************************************************************************
 *                                                                                                 *
 * SIZES                                                                                           *
 *                                                                                                 *
 ***************************************************************************************************/

@breakpoints {
  /* Container sizing - inherit from base menu */
  .rt-SidebarContainer {
    &:where(.rt-r-size-1) {
      --sidebar-base-padding: var(--space-3);
    }
    &:where(.rt-r-size-2) {
      --sidebar-base-padding: var(--space-4);
    }
  }

  /* Content sizing - use base menu tokens directly */
  .rt-SidebarContent {
    &:where(.rt-r-size-1) {
      --sidebar-content-padding: var(--base-menu-content-padding);
      --sidebar-item-padding-left: var(--base-menu-item-padding-left);
      --sidebar-item-padding-right: var(--base-menu-item-padding-right);
      --sidebar-item-padding-y: var(--base-menu-item-padding-y);
      --sidebar-item-height: var(--base-menu-item-height);
    }
    &:where(.rt-r-size-2) {
      --sidebar-content-padding: var(--base-menu-content-padding);
      --sidebar-item-padding-left: var(--base-menu-item-padding-left);
      --sidebar-item-padding-right: var(--base-menu-item-padding-right);
      --sidebar-item-padding-y: var(--base-menu-item-padding-y);
      --sidebar-item-height: var(--base-menu-item-height);
    }
  }

  /* Size-specific menu button styling - inherit from base menu */
  .rt-SidebarContent:where(.rt-r-size-1) {
    & :where(.rt-SidebarMenuButton) {
      gap: var(--component-gap-2);
      font-size: var(--font-size-1);
      line-height: var(--line-height-1);
      letter-spacing: var(--letter-spacing-1);
      border-radius: var(--radius-1);
      font-weight: var(--font-weight-medium);

      /* stylelint-disable-next-line selector-max-type */
      & :where(svg) {
        width: var(--content-icon-size-1);
        height: var(--content-icon-size-1);
        flex-shrink: 0;
      }
    }

    /* Sub-trigger icon sizing - matches base menu exactly */
    & :where(.rt-BaseMenuSubTriggerIcon) {
      width: var(--indicator-icon-size-1);
      height: var(--indicator-icon-size-1);
      flex-shrink: 0;
      margin-left: auto;
    }
  }

  .rt-SidebarContent:where(.rt-r-size-2) {
    & :where(.rt-SidebarMenuButton) {
      gap: var(--component-gap-3);
      font-size: var(--font-size-2);
      line-height: var(--line-height-2);
      letter-spacing: var(--letter-spacing-2);
      border-radius: var(--radius-2);
      font-weight: var(--font-weight-medium);

      /* stylelint-disable-next-line selector-max-type */
      & :where(svg) {
        width: var(--content-icon-size-2);
        height: var(--content-icon-size-2);
        flex-shrink: 0;
      }
    }

    /* Sub-trigger icon sizing - matches base menu exactly */
    & :where(.rt-BaseMenuSubTriggerIcon) {
      width: var(--indicator-icon-size-2);
      height: var(--indicator-icon-size-2);
      flex-shrink: 0;
      margin-left: auto;
    }
  }
}

/***************************************************************************************************
 *                                                                                                 *
 * MENU VARIANTS                                                                                   *
 *                                                                                                 *
 ***************************************************************************************************/

/* Menu Variant: Solid - EXACT match to base menu */
.rt-SidebarHeader:where(.rt-menu-variant-solid),
.rt-SidebarContent:where(.rt-menu-variant-solid),
.rt-SidebarFooter:where(.rt-menu-variant-solid) {
  /* Sub-trigger transitions - match base menu */
  & :where(.rt-SidebarMenuSubTrigger) {
    transition: var(--transition-menu);
    
    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      transition: none;
    }
    
    /* Remove backdrop-filter transitions in translucent mode to prevent flickering */
    :where([data-panel-background='translucent']) & {
      transition: background var(--duration-1) var(--ease-1), color var(--duration-2) var(--ease-1);
    }
  }

  /* Sub-trigger open state - match base menu */
  & :where(.rt-SidebarMenuSubTrigger[data-state='open']) {
    /* Base state: solid gray for solid panels */
    background-color: var(--gray-3);
    
    /* Theme-level translucent override */
    :where([data-panel-background='translucent']) & {
      background-color: var(--gray-a3);
    }

    /* Component-level overrides (higher specificity) */
    &:where([data-panel-background='solid']) {
      background-color: var(--gray-3);
      backdrop-filter: none;
      --backdrop-filter-components: none;
    }

    &:where([data-panel-background='translucent']) {
      background-color: var(--gray-a3);
    }
  }

  /* Menu item transitions - match base menu */
  & :where(.rt-SidebarMenuButton) {
    /* Remove backdrop-filter transitions in translucent mode to prevent flickering */
    :where([data-panel-background='translucent']) & {
      transition: background var(--duration-1) var(--ease-1), color var(--duration-2) var(--ease-1);
    }
  }

  /* Hover/highlighted state for solid variant - EXACT match to base menu */
  & :where(.rt-SidebarMenuButton[data-highlighted]) {
    background-color: var(--accent-9);
    color: var(--accent-contrast);

    & :where(.rt-BaseMenuSubTriggerIcon) {
      color: var(--accent-contrast);
    }

    /* Force all text elements to inherit hover color, including those with color="gray" */
    & :where(.rt-Text) {
      color: inherit !important;
    }

    /* Also target any element with data-accent-color="gray" */
    & :where([data-accent-color='gray']:not(.rt-Badge)) {
      color: inherit !important;
    }

    /* FIX: Ensure badges maintain their own styling and don't inherit hover colors */
    & :where(.rt-Badge) {
      color: var(--accent-contrast) !important;
      background-color: var(--accent-12) !important;
    }
  }

  /* Active navigation state for solid variant - same as highlighted */
  & :where(.rt-SidebarMenuButton[data-active]) {
    background-color: var(--accent-9);
    color: var(--accent-contrast);

    /* Force all text elements to inherit active color */
    & :where(.rt-Text) {
      color: inherit !important;
    }

    & :where([data-accent-color='gray']:not(.rt-Badge)) {
      color: inherit !important;
    }

    /* FIX: Ensure badges maintain their own styling and don't inherit active colors */
    & :where(.rt-Badge) {
      color: var(--accent-contrast) !important;
      background-color: var(--accent-12) !important;
    }
  }

  /* High contrast support for solid variant - EXACT match to base menu */
  &:where(.rt-high-contrast) {
    & :where(.rt-SidebarMenuButton[data-highlighted]) {
      background-color: var(--accent-12);
      color: var(--accent-1);

      & :where(.rt-BaseMenuSubTriggerIcon) {
        color: var(--accent-1);
      }

      /* Force all text elements to inherit hover color in high contrast mode */
      & :where(.rt-Text) {
        color: inherit !important;
      }

      /* Also target any element with data-accent-color="gray" in high contrast */
      & :where([data-accent-color='gray']:not(.rt-Badge)) {
        color: inherit !important;
      }

      /* FIX: High contrast badge styling */
      & :where(.rt-Badge) {
        color: var(--accent-1) !important;
        background-color: var(--accent-9) !important;
      }

      &:where([data-accent-color]) {
        background-color: var(--accent-9);
        color: var(--accent-contrast);

        & :where(.rt-Text) {
          color: inherit !important;
        }

        & :where([data-accent-color='gray']:not(.rt-Badge)) {
          color: inherit !important;
        }

        & :where(.rt-Badge) {
          color: var(--accent-contrast) !important;
          background-color: var(--accent-12) !important;
        }
      }
    }

    & :where(.rt-SidebarMenuButton[data-active]) {
      background-color: var(--accent-12);
      color: var(--accent-1);

      & :where(.rt-Text) {
        color: inherit !important;
      }

      & :where([data-accent-color='gray']:not(.rt-Badge)) {
        color: inherit !important;
      }

      & :where(.rt-Badge) {
        color: var(--accent-1) !important;
        background-color: var(--accent-9) !important;
      }

      &:where([data-accent-color]) {
        background-color: var(--accent-9);
        color: var(--accent-contrast);

        & :where(.rt-Text) {
          color: inherit !important;
        }

        & :where([data-accent-color='gray']:not(.rt-Badge)) {
          color: inherit !important;
        }

        & :where(.rt-Badge) {
          color: var(--accent-contrast) !important;
          background-color: var(--accent-12) !important;
        }
      }
    }
  }
}

/* Menu Variant: Soft - EXACT match to base menu */
.rt-SidebarHeader:where(.rt-menu-variant-soft),
.rt-SidebarContent:where(.rt-menu-variant-soft),
.rt-SidebarFooter:where(.rt-menu-variant-soft) {
  /* Sub-trigger transitions - match base menu */
  & :where(.rt-SidebarMenuSubTrigger) {
    transition: var(--transition-menu);
    
    /* Reduced motion support */
    @media (prefers-reduced-motion: reduce) {
      transition: none;
    }
    
    /* Remove backdrop-filter transitions in translucent mode to prevent flickering */
    :where([data-panel-background='translucent']) & {
      transition: background var(--duration-1) var(--ease-1), color var(--duration-2) var(--ease-1);
    }
  }

  /* Sub-trigger open state - match base menu */
  & :where(.rt-SidebarMenuSubTrigger[data-state='open']) {
    /* Base state: solid accent for solid panels */
    background-color: var(--accent-3);
    
    /* Theme-level translucent override */
    :where([data-panel-background='translucent']) & {
      background-color: var(--accent-a3);
    }

    /* Component-level overrides (higher specificity) */
    &:where([data-panel-background='solid']) {
      background-color: var(--accent-3);
      backdrop-filter: none;
      --backdrop-filter-components: none;
    }

    &:where([data-panel-background='translucent']) {
      background-color: var(--accent-a3);
    }
  }

  /* Menu item transitions - match base menu */
  & :where(.rt-SidebarMenuButton) {
    /* Remove backdrop-filter transitions in translucent mode to prevent flickering */
    :where([data-panel-background='translucent']) & {
      transition: background var(--duration-1) var(--ease-1), color var(--duration-2) var(--ease-1);
    }
  }

  /* Hover/highlighted state for soft variant - EXACT match to base menu */
  & :where(.rt-SidebarMenuButton[data-highlighted]) {
    /* Base state: solid accent for solid panels */
    background-color: var(--accent-4);
    
    /* Theme-level translucent override */
    :where([data-panel-background='translucent']) & {
      background-color: var(--accent-a4);
    }

    /* Component-level overrides (higher specificity) */
    &:where([data-panel-background='solid']) {
      background-color: var(--accent-4);
      backdrop-filter: none;
      --backdrop-filter-components: none;
    }

    &:where([data-panel-background='translucent']) {
      background-color: var(--accent-a4);
    }

    /* In soft variant, improve contrast for gray text while maintaining hierarchy */
    & :where(.rt-Text[data-accent-color='gray'], [data-accent-color='gray']:not(.rt-Badge)) {
      color: var(--gray-11) !important;
    }
  }

  /* Active navigation state for soft variant - use accent-3 like sub-trigger */
  & :where(.rt-SidebarMenuButton[data-active]) {
    /* Base state: solid accent for solid panels */
    background-color: var(--accent-3);
    color: var(--accent-12);

    /* Theme-level translucent override */
    :where([data-panel-background='translucent']) & {
      background-color: var(--accent-a3);
      color: var(--accent-a12);
    }

    /* Component-level overrides (higher specificity) */
    &:where([data-panel-background='solid']) {
      background-color: var(--accent-3);
      color: var(--accent-12);
      backdrop-filter: none;
      --backdrop-filter-components: none;
    }

    &:where([data-panel-background='translucent']) {
      background-color: var(--accent-a3);
      color: var(--accent-a12);
    }

    /* In soft variant, improve contrast for gray text while maintaining hierarchy */
    & :where(.rt-Text[data-accent-color='gray'], [data-accent-color='gray']:not(.rt-Badge)) {
      color: var(--gray-11) !important;
    }
  }
}

/* Removed old icon-only collapsed mode rules in favor of Shell rail mode */