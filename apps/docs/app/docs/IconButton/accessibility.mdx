import { IconButton, Flex, Box, Text, Callout } from '@kushagradhawan/kookie-ui';
import { Settings, TriangleAlertIcon, Heart, Share2, Download } from 'lucide-react';
import { CodeBlock } from '../../components/CodeBlock';

# Accessibility

The IconButton component is built with comprehensive accessibility features that work for everyone, regardless of ability or interaction method. It implements systematic color contrast, semantic markup, keyboard navigation, and assistive technology support out of the box, with specialized requirements for icon-only interactions.

You can trust that every IconButton automatically provides the same experience for all users without additional configuration, while enforcing mandatory labeling for icon-only content.

## Color and Contrast

The IconButton component uses a systematic color approach that ensures all button combinations maintain minimum 3:1 contrast ratios meeting WCAG accessibility standards. The color system automatically calculates these relationships to ensure compliance without manual testing.

**Solid buttons** automatically use `--accent-contrast` text on `--accent-9` backgrounds for maximum contrast. **All other variants** automatically use `--accent-11` text, which maintains proper contrast against both subtle backgrounds and container surfaces.

<Callout.Root size="3" variant="surface" color="gray" my="8">
  <Callout.Icon>
    <TriangleAlertIcon />
  </Callout.Icon>
  <Callout.Text>The color system uses APCA (Advanced Perceptual Contrast Algorithm) targets, which accurately predict how human vision perceives text contrast across different color combinations and lighting conditions.</Callout.Text>
</Callout.Root>

### High Contrast

The `highContrast` prop automatically ensures maximum visibility for users with visual impairments or challenging viewing conditions. When enabled, it increases color saturation, improves contrast ratios, and enhances focus indicators across all variants.

<CodeBlock
  preview={
    <Flex gap="3" wrap="wrap">
      <IconButton size="3" variant="solid" aria-label="Settings">
        <Settings />
      </IconButton>
      <IconButton size="3" variant="solid" highContrast aria-label="Settings">
        <Settings />
      </IconButton>
    </Flex>
  }
>

```tsx
{/* Standard contrast for most interfaces */}
<IconButton size="3" variant="solid" aria-label="Settings">
  <Settings />
</IconButton>

{/* Automatically enhanced contrast for accessibility */}
<IconButton size="3" variant="solid" highContrast aria-label="Settings">
  <Settings />
</IconButton>
```

</CodeBlock>

## Keyboard Navigation

The IconButton component automatically supports full keyboard accessibility with standard interaction patterns. **Enter and Space keys** activate buttons. **Tab navigation** moves between buttons in logical order. **Focus indicators** automatically use 2px outlines with appropriate colors and offsets per variant.

The focus-visible implementation automatically shows focus rings only for keyboard navigation, not mouse clicks. This provides clear navigation cues without visual clutter.

<CodeBlock
  preview={
    <Flex gap="3" wrap="wrap">
      <IconButton size="3" variant="solid" aria-label="Settings">
        <Settings />
      </IconButton>
      <IconButton size="3" variant="outline" aria-label="Heart">
        <Heart />
      </IconButton>
      <IconButton size="3" variant="ghost" aria-label="Share">
        <Share2 />
      </IconButton>
    </Flex>
  }
>

```tsx
{/* All icon buttons automatically support keyboard navigation */}
<IconButton size="3" variant="solid" aria-label="Settings">
  <Settings />
</IconButton>
<IconButton size="3" variant="outline" aria-label="Heart">
  <Heart />
</IconButton>
<IconButton size="3" variant="ghost" aria-label="Share">
  <Share2 />
</IconButton>
```

</CodeBlock>

## Screen Reader Support

The IconButton component automatically uses semantic `<button>` elements with proper ARIA attributes for comprehensive screen reader compatibility. All button states automatically communicate clearly to assistive technology, with mandatory labeling for icon-only content.

### Required Labeling

IconButton requires either `aria-label` or `aria-labelledby` to provide context for icon-only actions. This ensures screen readers can announce the button's purpose clearly.

<CodeBlock
  preview={
    <Flex gap="3" wrap="wrap">
      <IconButton size="3" variant="solid" aria-label="Open settings">
        <Settings />
      </IconButton>
      <IconButton size="3" variant="outline" aria-label="Add to favorites">
        <Heart />
      </IconButton>
    </Flex>
  }
>

```tsx
{/* Required: aria-label for screen readers */}
<IconButton size="3" variant="solid" aria-label="Open settings">
  <Settings />
</IconButton>

{/* Alternative: aria-labelledby for complex labels */}
<div id="settings-desc">Open application settings panel</div>
<IconButton size="3" variant="outline" aria-labelledby="settings-desc">
  <Settings />
</IconButton>
```

</CodeBlock>

<Callout.Root size="3" variant="surface" color="gray" my="8">
  <Callout.Icon>
    <TriangleAlertIcon />
  </Callout.Icon>
  <Callout.Text>IconButton requires either aria-label or aria-labelledby. Without proper labeling, screen readers cannot announce the button's purpose.</Callout.Text>
</Callout.Root>

**Loading states** automatically use `aria-busy="true"` and `aria-describedby` to announce processing status. The original button text remains available to screen readers while a visual spinner indicates progress.

<CodeBlock
  preview={
    <IconButton size="3" variant="solid" loading aria-label="Processing order">
      <Download />
    </IconButton>
  }
>

```tsx
{/* Screen readers automatically announce "Processing order, busy" */}
<IconButton size="3" variant="solid" loading aria-label="Processing order">
  <Download />
</IconButton>
```

</CodeBlock>

**Disabled states** automatically use proper `disabled` attributes and visual indicators. Screen readers automatically announce the unavailable state while visual styling prevents interaction confusion.

<CodeBlock
  preview={
    <Flex gap="3" wrap="wrap">
      <IconButton size="3" variant="solid" disabled aria-label="Disabled action">
        <Settings />
      </IconButton>
      <IconButton size="3" variant="outline" disabled aria-label="Disabled secondary">
        <Heart />
      </IconButton>
    </Flex>
  }
>

```tsx
{/* Screen readers automatically announce "Disabled action, button, unavailable" */}
<IconButton size="3" variant="solid" disabled aria-label="Disabled action">
  <Settings />
</IconButton>
<IconButton size="3" variant="outline" disabled aria-label="Disabled secondary">
  <Heart />
</IconButton>
```

</CodeBlock>

## Touch Targets

The IconButton component automatically accommodates users with varying motor abilities. All sizes automatically meet or exceed accessibility guidelines for minimum touch targets, with square aspect ratios optimized for icon interactions.

**Size Guidelines:**
- **Size 1 (24px):** Automatically suitable for dense interfaces where space is limited
- **Size 2 (32px):** Automatically suitable for standard interfaces with comfortable padding  
- **Size 3 (40px):** Automatically suitable for important actions and mobile touch targets
- **Size 4 (48px):** Automatically suitable for hero sections and maximum accessibility

<CodeBlock
  preview={
    <Flex gap="3" align="center" wrap="wrap">
      <IconButton variant="solid" size="1" aria-label="Compact">
        <Settings />
      </IconButton>
      <IconButton variant="solid" size="2" aria-label="Standard">
        <Settings />
      </IconButton>
      <IconButton variant="solid" size="3" aria-label="Prominent">
        <Settings />
      </IconButton>
      <IconButton variant="solid" size="4" aria-label="Hero">
        <Settings />
      </IconButton>
    </Flex>
  }
>

```tsx
{/* All sizes automatically maintain proper touch targets */}
<IconButton variant="solid" size="1" aria-label="Compact">
  <Settings />
</IconButton>
<IconButton variant="solid" size="2" aria-label="Standard">
  <Settings />
</IconButton>
<IconButton variant="solid" size="3" aria-label="Prominent">
  <Settings />
</IconButton>
<IconButton variant="solid" size="4" aria-label="Hero">
  <Settings />
</IconButton>
```

</CodeBlock>

**Flush buttons** automatically maintain full accessibility while achieving visual integration. Negative margins affect only visual positioningâ€”the clickable area automatically remains unchanged.

<CodeBlock
  preview={
    <Flex align="center" gap="2">
      <Text>Inline text with</Text>
      <IconButton variant="ghost" size="3" flush aria-label="flush action">
        <Settings />
      </IconButton>
      <Text>continuing seamlessly</Text>
    </Flex>
  }
>

```tsx
{/* Full touch target automatically preserved despite visual flush */}
<Flex align="center" gap="2">
  <Text>Inline text with</Text>
  <IconButton variant="ghost" size="3" flush aria-label="flush action">
    <Settings />
  </IconButton>
  <Text>continuing seamlessly</Text>
</Flex>
```

</CodeBlock>

## Motion Preferences

The IconButton component automatically respects user motion preferences. All transitions and animations automatically disable when users indicate motion sensitivity, ensuring comfortable interaction for users with vestibular disorders.

```css
@media (prefers-reduced-motion: reduce) {
  transition: none;
  animation: none;
}
```

## Enhanced Loading States

The loading state automatically provides comprehensive accessibility support beyond basic visual feedback.

<CodeBlock
  preview={
    <IconButton size="3" loading aria-label="Processing">
      <Download />
    </IconButton>
  }
>

```tsx
{/* Enhanced loading accessibility automatically included */}
<IconButton loading aria-label="Processing">
  <Download />
</IconButton>
```

</CodeBlock>

**Automatic accessibility features:**
- `aria-busy="true"` automatically announces processing state
- `aria-disabled="true"` automatically prevents interaction
- `aria-describedby` automatically links to loading announcement
- VisuallyHidden text automatically includes: "Loading, please wait..."
- Original button text automatically remains available to screen readers

## Tooltip Accessibility

IconButton includes enhanced tooltip accessibility for icon-only interactions. Tooltips provide additional context that complements the required aria-label.

<CodeBlock
  preview={
    <Flex gap="3" wrap="wrap">
      <IconButton size="3" variant="solid" aria-label="Open settings" tooltip="Open settings">
        <Settings />
      </IconButton>
      <IconButton size="3" variant="outline" aria-label="Add to favorites" tooltip="Add to favorites">
        <Heart />
      </IconButton>
    </Flex>
  }
>

```tsx
{/* Tooltip provides additional context */}
<IconButton 
  size="3" 
  variant="solid" 
  aria-label="Open settings"
  tooltip="Open settings"
>
  <Settings />
</IconButton>

{/* Tooltip can provide more detailed information */}
<IconButton 
  size="3" 
  variant="outline" 
  aria-label="Add to favorites"
  tooltip="Add this item to your favorites list"
>
  <Heart />
</IconButton>
```

</CodeBlock>

**Automatic features:**
- Automatic focus and hover triggers
- Automatic proper ARIA labeling
- Automatic keyboard navigation support
- Automatic screen reader announcements

**Tooltip Best Practices:**
- Use tooltips to provide additional context beyond the aria-label
- Keep tooltip text concise but descriptive
- Consider using tooltips for complex actions that need explanation
- Tooltips should complement, not replace, proper aria-labeling

## Testing Guidelines

**Keyboard Testing:**
- Tab through all icon buttons in logical order
- Activate with Enter and Space keys
- Verify focus indicators are clearly visible

**Screen Reader Testing:**
- Test with NVDA, JAWS, or VoiceOver
- Verify loading and disabled states announce correctly
- Check button labels are descriptive and meaningful
- Ensure every icon button has proper aria-label or aria-labelledby

**Visual Testing:**
- Validate high contrast mode
- Test color contrast ratios
- Verify touch targets on mobile devices

**Icon-Specific Testing:**
- Ensure every IconButton has either `aria-label` or `aria-labelledby`
- Verify tooltips provide additional context when needed
- Test icon recognition and meaning clarity
- Validate context clarity from button placement and labeling

**Polymorphic Usage:**
When using `as` prop or `asChild`, the component automatically maintains proper ARIA roles, keyboard interaction, and semantic relationships. 